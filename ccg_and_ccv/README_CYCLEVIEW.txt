/*** CycleView 2.1 ************************************************************\
 * Author:         twisted_nematic57                                          *
 * Date:           04/18/2025 [MM-DD-YYYY]                                    *
 * License:        Public Domain :)                                           *
 * Product Type:   BASIC program                                              *
 * Platform:       TI-89 Titanium - can be ported to other Motorola 68000     *
                   based TI calculators with ease.                            *
\******************************************************************************/

CycleView is a replacement for the AMS's CyclePic instruction. It is a BASIC
program that enables the user to play back and scrub through animations
frame-by-frame, and features very simple and easy-to-remember keybinds. It's
also slightly optimized, and is quite performant.

 - created and refined with passion.


I. INSTALLATION

All files being referred to in this section are in the `distribution` folder.

Send `ccv.89p` to your calculator with your favorite linking software. It should
 be archived.
It will be in its own folder `AAA` so that you can access it quickly from the
 VAR-LINK menu, but it's fine to store it anywhere.

IF you haven't already done this while installing CycleGen:
Send "statline.89z" to your calculator. It should be in the `misc` folder
 on-calc, and should be archived. It is used to manipulate the status line.
 https://www.cemetech.net/downloads/files/2600/x3320


II. PROGRAM DESCRIPTION

The program is centered around displaying many picture variables via the RplcPic
instruction in quick succession to show an animation. It is specifically
designed to work with images generated by CycleGen.

CycleView's format of data is also playable by the OS's built-in CyclePic
instruction, but there are 3 key differences between this program and CyclePic:

 * CyclePic does not support playing more than 50 frames at once.
    - CycleView (this program) supports as many images as will fit in memory.

 * CyclePic does not support frame scrubbing. That is, you cannot play/pause the
   animation and move between individual frames on demand.
    - CycleView implements this functionality in a very intuitive manner using
      the D-pad and [ESC] keys.

 * CyclePic exposes a setting that modifies the amount of time that each frame
   is displayed for.
    - CycleView does NOT implement delay functionality while playing the
      animation; it simply cycles through frames as fast as the calculator can
      process them.
       ~ This feature was deemed unnecessary due to the availability of frame
         scrubbing. Please use that instead to get a chance to take a longer
         look at each frame.

This is designed to play animations generated by CycleGen, but really it can
play anything that's in the right format. These are the only requirements:
 - All the frame names must start with the same string. This string may be up to
   5 characters long. (E.g. "pic1","pic2","pic3", etc.)
 - They must be numbered sequentially using integers. So frame 1 would end with
   1, frame 2 would end with 2, etc. Names should not be padded with zeros.
 - They have to be in the AMS's standard picture format - monochrome. They can
   technically be any size, but keep in mind they're always anchored in the top
   left corner of the Graph Screen.


III. USAGE

 * The user launches the program with arguments that give it information about
   the frames it's expected to play back. The specification for the arguments is
   in the order they should be passed below:

    - `picprfx`: A string containing the prefix of each picture. The "prefix" is
                 just the string that comes before the number of each frame.
                  ~ For example, if all of the frames are in the `ctmp` folder
                    and their names start with `p`, then this argument should be
                    "ctmp\p".
                  ~ Another example: if the frames are in the current folder and
                    they begin with `frm`, then the prefix would just be "frm".

    - `npicstrt`: A positive integer denoting the frame number to begin playing
                  the animation on.

    - `npicend`: A positive integer denoting the frame number to stop playing
                 the animation at.

    - `replay`: A number which tells the program how it should behave when it
                finishes playing all available frames.
                 ~ If set to 0, it will just cycle through all the frames once
                   and exit when finished.
                 ~ If set to 1, the program will play the entire sequence of
                   frames again from the start in the same order when it's
                   finished playing to the end of the sequence. This goes on
                   forever until the user presses [CLEAR] or [HOME] to exit the
                   program.
                 ~ If set to -1, the program will reverse the order of the
                   frames when it's finished playing through all of them. So
                   it'll play from the start to the end, then the end to the
                   start, then the start to the end again, over and over until
                   the [CLEAR] or [HOME] key is pressed.
   
 * The program displays the frames in quick succession to show the animation.
    - All functions in the Y= editor are disabled to prevent the calculator from
      trying to render the graph again before you attempt to view the animation.

 * If the user presses [LEFT] or [RIGHT], the animation stops and the left and
   right arrow keys can be used to scrub through individual frames of the
   animation. Pressing [ESC] exits out of this frame-scrubbing mode and resumes
   normal playback of the animation.
    - The [LEFT] arrow key always displays the previous frame of the sequence
      (the one with a smaller number at the end). Vice versa for the [RIGHT]
      arrow key. This is true regardless of the current `replay` setting.
    - While in frame-scrubbing mode, the status bar will contain a message
      showing the full path of the currently displayed image.

 * The [CLEAR]/[HOME] keys may be pressed at any time to exit out of the program
   and return to the Home Screen.

DISCLAIMER: Using the program in ways that deviate from the specification above
may cause unexpected and erratic behavior. No damage should ever occur to your
calculator by using this program, but the author(s) of this program do not claim
liability for ANYTHING should undesirable events occur as a result of the
distribution, storage, compression, or execution of this program.


IV. EXAMPLES

`ccv("frame",1,9,0)` Plays back frames in the current folder with names starting
with `frame` from 1 through 9. The animation plays in order and exits after the
9th frame unless interrupted. The Home Screen is not displayed if manual
interruption does not occur.

`ccv("ctmp\pic",1,79,-1)` will play back frames 1 through 79 in the `ctmp`
folder starting with `pic` in alternating straight and reverse order. This will
continue forever until the user presses [HOME] or [CLEAR] to quit the program.


V. KEYBINDS REVIEW

When actively playing an animation:
 - [LEFT]/[RIGHT] (on D-pad) enter frame scrubbing mode
 - [CLEAR]/[HOME] quits the program and returns the calc to the home screen

When in frame scrubbing mode:
 - [LEFT] moves one frame back
 - [RIGHT] moves one frame forward
 - [ESC] exits frame scrubbing mode and resumes normal playback of the animation
 - [CLEAR]/[HOME] quits the program and returns the calc to the home screen


VI. CHANGELOG (LATEST-FIRST)

 * CycleView 2.1: fix some inconveniences
    - CODE: make sure that the calc never tries to re-render the graph after
            finishing animation... that was so annoying earlier
    - CODE: use statline instead of flib for status line messages
             ~ yippee, this can finally be non-GPL and a little faster
    - DOC: clarify that the [HOME] key can also be used to exit the program
    - MISC: include well-formatted, highlighted PDF source instead of plaintext

 * CycleView 2.0: Initial release; Allows playback of animations formatted
                  mostly the same way as CyclePic; (there is no 1.0 or 1.1 to
                  prevent versioning confusion)
    - CODE: create an animation player using a while loop with keypress
            detection, and react accordingly - basic keybinds implemented
       ~ optimization by wrapping the main keypress reaction code in a giant if,
         not indented as stylistic choice - calc only has to check a single if
         this way in the main loop, makes it faster 99% of the time
    - DOC: document how the program should be used
    - DOC: provide some rudimentary examples (...it's pretty simple, do we even
           need these?)
